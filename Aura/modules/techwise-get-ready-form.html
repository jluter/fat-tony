<div id="contactForm">
    <div class="contact-form__background-container">
        <div class="contact-form__wrapper">
            <div class="contact-form__top-content">
                <div class="contact-form__header">
                    Ready to Get Started?
                </div>
                <div class="contact-form__p">
                    If you want to take the next steps to learn more about participating in this one-of-a-kind online
                    study, just fill out
                    the form below and weâ€™ll be in touch soon.
                </div>
            </div>
            <form class="contact-form">
                <div class="contact-form__column-wrapper">
                    <div class="contact-form__first-row">
                        <div class="contact-form__input-label-wrapper">
                            <label for="parentFirstName" class="contact-form__label">First Name of Parent</label>
                            <input type="text" id="parentFirstName" class="contact-form__input-field"
                                name="parentFirstName" placeholder="First Name" required />
                        </div>
                        <div class="contact-form__input-label-wrapper">
                            <label for="parentLastName" class="contact-form__label">Last Name of Parent</label>
                            <input type="text" id="parentLastName" class="contact-form__input-field"
                                name="parentLastName" placeholder="Last Name" required />
                        </div>
                    </div>
                    <div class="contact-form__second-row">
                        <div class="contact-form__input-label-wrapper">
                            <label for="childFirstName" class="contact-form__label">Child's First Name</label>
                            <input type="text" id="childFirstName" class="contact-form__input-field"
                                name="childFirstName" placeholder="First Name" required />
                        </div>
                        <div class="contact-form__input-label-wrapper">
                            <label for="childLastName" class="contact-form__label">Child's Last Name</label>
                            <input type="text" id="childLastName" class="contact-form__input-field"
                                name="parentLastName" placeholder="Last Name" required />
                        </div>
                    </div>
                    <div class="contact-form__third-row">
                        <div class="contact-form__input-label-wrapper parent-email">
                            <label for="parentEmail" class="contact-form__label">Parent Email</label>
                            <input type="email" id="parentEmail" class="contact-form__input-field" name="parentEmail"
                                placeholder="name@email.com" pattern="^[^@]+@[^@]+\.[a-zA-Z]{2,}$" required />
                            <label for="parentEmail" class="contact-form__label-error">Email must be unique</label>
                        </div>
                        <div class="contact-form__child-email-age-wrapper">
                            <div class="contact-form__input-label-wrapper child-email">
                                <label for="childEmail" class="contact-form__label child-email">Child's Email</label>
                                <input type="email" id="childEmail" class="contact-form__input-field" name="childEmail"
                                    placeholder="name@email.com" pattern="^[^@]+@[^@]+\.[a-zA-Z]{2,}$" required />
                                <label for="parentEmail" class="contact-form__label-error">Email must be unique</label>
                            </div>
                            <div class="contact-form__input-label-wrapper child-age">
                                <label for="childAge" class="contact-form__label child-age">Child's Age</label>
                                <input type="number" id="childAge" class="contact-form__input-field" name="childAge"
                                    min="8" max="17" placeholder="0" required />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="contact-form__checkbox-consent-wrapper">
                    <input type="checkbox" id="checkboxConsent" name="checkboxConsent" value="consent" required />
                    <label for="checkboxConsent" class="checkbox-consent-label">By checking this box and submitting this
                        form, you give permission for Aura's TECHWISE study and Castor Connects to send
                        you an e-mail invitation to the Aura TECHWISE study and acknowledge <a
                            href="https://www.aura.com/legal/privacy-policy" target="_blank"
                            aria-label="View Aura's Privacy Policy" rel="noopener noreferrer"><u>Aura's Privacy
                                Policy</u></a>.</label>
                </div>
                <div class="contact-form__submit-wrapper">
                    <button class="contact-form__submit-button" type="submit" aria-label="Submit Interest Form">
                        <p>Submit</p>
                        <img class="aura-cta-icon"
                            src="https://v.fastcdn.co/u/bff2cbd9/60877781-0-result---2022-02-07T.svg" alt="" />
                    </button>
                    <div class="contact-form__loading-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" role="img"
                            aria-labelledby="formLoadingSvgTitle" aria-describedby="formLoadingSvgDesc">
                            <title id="formLoadingSvgTitle">Loading Indicator</title>
                            <desc id="formLoadingSvgDesc">An animation of dots rotating in a circle.</desc>
                            <linearGradient id="a12">
                                <stop offset="0" stop-color="#3366FF" stop-opacity="0"></stop>
                                <stop offset="1" stop-color="#3366FF"></stop>
                            </linearGradient>
                            <circle fill="none" stroke="url(#a12)" stroke-width="15" stroke-linecap="round"
                                stroke-dasharray="0 44 0 44 0 44 0 44 0 360" cx="100" cy="100" r="70"
                                transform-origin="center">
                                <animateTransform type="rotate" attributeName="transform" calcMode="discrete" dur="1"
                                    values="360;324;288;252;216;180;144;108;72;36" repeatCount="indefinite">
                                </animateTransform>
                            </circle>
                        </svg>
                    </div>
                    <div class="contact-form__confirmation">
                        <img class="contact-form__confirmation-check" alt=""
                            src="https://v.fastcdn.co/u/bff2cbd9/65237276-0-Blue-checkmark.svg" />
                        <p class="contact-form__confirmation-p">Submission confirmed. Please fill out again for each
                            additional child.</p>
                    </div>
                </div>
            </form>
        </div>

    </div>

    <div class="contact-form__questions-container">
        <p class="contact-form__questions-title">Have Questions?</p>
        <p class="contact-form__questions-p">Contact us at: <br class="is-mobile" /><u>AuraResearchSupport@aura.com</u>
        </p>
    </div>
</div>

<style>
    .contact-form {
        display: flex;
        flex-direction: column;
    }

    .contact-form__background-container {
        border-radius: 1.5rem;
        background-color: #ffffff;
    }

    .contact-form__wrapper {
        padding: 3.75rem 11.5rem 4rem 11.5rem;
    }

    .contact-form__column-wrapper {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin: 0 auto;
    }

    .contact-form__first-row,
    .contact-form__second-row,
    .contact-form__third-row {
        width: 100%;
        display: flex;
        gap: 0.75rem;
    }

    .contact-form__top-content {
        text-align: center;
        display: flex;
        flex-direction: column;
        padding-bottom: 2.5rem;
        gap: 0.75rem;
    }

    .contact-form__input-label-wrapper {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
        width: 22.5rem;
    }

    .contact-form__input-label-wrapper.parent-email {
        width: 50%;
        position: relative;
    }

    .contact-form__input-field {
        width: 100%;
        border-radius: 0.5rem;
        height: 2.5rem;
        padding-left: 0.75rem;
        border: 1px solid #161616;
    }

    .contact-form__header {
        font-family: 'Clarendon Graphic';
        font-size: 3rem;
    }

    .contact-form__p {
        font-family: 'Basel Grotesk';
        font-size: 1.125rem;
    }

    .contact-form__label {
        font-family: 'Basel Grotesk';
        font-size: 0.875rem;
    }

    .contact-form__input-label-wrapper.child-email {
        position: relative;
        width: 70%;
    }

    .contact-form__input-label-wrapper.child-age {
        width: 30%;
    }

    .contact-form__child-email-age-wrapper {
        display: flex;
        gap: 0.75rem;
        width: 50%;
    }

    .contact-form__label-error {
        position: absolute;
        color: red;
        bottom: -1.25rem;
        padding-left: 0.75rem;
        font-family: 'Basel Grotesk';
        font-size: 0.875rem;
        display: none;
    }

    .contact-form__label-error.active-error {
        display: block;
    }

    .contact-form__input-field.active-error {
        border: 1px solid red;
    }

    .contact-form__checkbox-consent-wrapper {
        padding: 2rem 0;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .checkbox-consent-label {
        font-family: 'Basel Grotesk';
        font-size: 0.875rem;
        color: #4D4D4D;
        text-align: left;
        display: inline-block;
    }

    #checkboxConsent {
        width: 1rem;
        border-color: #A3ABBF;
        margin-top: 0.25rem;
    }

    .contact-form__submit-button {
        background: #3366FF;
        height: 3.9375rem;
        width: 12.875rem;
        display: flex;
        border-radius: 41px;
        align-items: center;
        border: 1px solid transparent;
        color: #ffffff;
        font-family: 'Basel Grotesk';
        font-size: 1.375rem;
        justify-content: center;
        transition: all 0.3s ease;
        text-align: center;
        cursor: pointer;
    }

    .contact-form__submit-wrapper {
        display: flex;
        align-items: center;
    }

    .contact-form__loading-icon {
        display: none;
        width: 3.5rem;
        margin-left: 2rem;
    }

    .contact-form__loading-icon.loading-visible {
        display: block;
    }

    .contact-form__confirmation {
        display: none;
        margin-left: 2rem;
        align-items: center;
        gap: 0.75rem;
    }

    .contact-form__confirmation.confirmed-visible {
        display: flex;
    }

    .contact-form__confirmation-check {
        height: 2rem;
    }

    .contact-form__confirmation-p {
        font-size: 0.875rem;
        font-family: 'Basel Grotesk';
        color: #4D4D4D;
        text-align: left;

    }

    .contact-form__submit-button:hover {
        box-shadow: -3px 3px 0px rgba(0 0 0 / 0.9);
        transform: translate(4px, -4px);
    }

    .contact-form__questions-container {
        display: flex;
        justify-content: center;
        padding-top: 4.5rem;
        align-items: flex-end;
        gap: 0.5rem;
    }

    .contact-form__questions-title {
        font-family: 'Clarendon Graphic';
        font-size: 2.25rem;
    }

    .contact-form__questions-p {
        font-family: 'Basel Grotesk';
        font-size: 1.375rem;
        margin-bottom: 0.5rem;
    }

    /*Desktop Only Styles*/
    @media screen and (min-width: 769px) {
        .is-mobile {
            display: none;
        }
    }

    /*Mobile Only Styles*/
    @media screen and (max-width: 768px) {
        .is-desktop {
            display: none;
        }

        .contact-form__background-container {
            border-radius: 1rem;
        }

        .contact-form__wrapper {
            padding: 2rem 1.5rem;
        }

        .contact-form__column-wrapper {
            flex-direction: column;
            margin: 0;
        }

        .contact-form__first-row,
        .contact-form__second-row,
        .contact-form__third-row {
            flex-direction: column;
            width: 100%;
        }

        .contact-form__child-email-age-wrapper {
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        .contact-form__input-label-wrapper {
            width: 100% !important;
        }

        .contact-form__submit-button {
            width: 100%;
        }

        .contact-form__header {
            font-size: 1.875rem;
        }

        .contact-form__top-content {
            gap: 1rem;
        }

        .contact-form__questions-container {
            flex-direction: column;
            padding-top: 2.5rem;
        }

        .contact-form__questions-title,
        .contact-form__questions-p {
            margin: 0 auto;
        }

        .contact-form__questions-title {
            font-size: 1.5rem;
        }

        .contact-form__questions-p {
            font-size: 1rem;
            line-height: 1.375rem;
        }

        .contact-form__label-error {
            right: 0;
            padding-right: 0.75rem;
        }

        .contact-form__submit-wrapper {
            flex-direction: column;
            gap: 1.2rem;
        }

        .contact-form__confirmation {
            margin: 0 auto;
        }

        .contact-form__loading-icon {
            margin: 0;
        }
    }
</style>

<script>
    //Make Checkbox selectable by enter key
    document.addEventListener('DOMContentLoaded', () => {
        const formCheckBox = document.querySelector("#checkboxConsent");
        const handleCheckBoxKeydown = (event) => {

            const { key, which } = event;
            const keysToMatch = ['Enter', ''];
            const whichCodesToMatch = [32, 13];

            if (keysToMatch.includes(key) || whichCodesToMatch.includes(which)) {
                //Only prevent default actions if the keys are correct, otherwise checkbox loses accessibility functions
                event.preventDefault();
                formCheckBox.checked = formCheckBox.checked ? false : true;
            }
        }

        formCheckBox.addEventListener('keydown', handleCheckBoxKeydown);

    });

    const contactFormElement = document.querySelector('.contact-form');
    const submitButtonElement = document.querySelector(".contact-form__submit-button");
    const submitForm = (event) => {

        // Get form data
        const formData = new FormData(event.target);
        let formEntries = [];
        try {
            // formData.entries().forEach(entry => {
            //     formEntries.push({
            //         elementID: entry[0],
            //         value: entry[1]
            //     })
            // });

            for (const [key, value] of formData.entries()) {
                formEntries.push({
                    elementID: key,
                    value: value
                })
            }

        } catch (error) {
            console.log(error);
        }

        //Extract the emails form the form data, as it's all we need for our POST request
        const parentEmail = formEntries[4];
        const childEmail = formEntries[5];

        //grabbing relevant DOM elements for styling changes
        const parentEmailElement = document.querySelector(`#parentEmail`);
        const childEmailElement = document.querySelector(`#childEmail`);
        const emailErrorLabels = document.querySelectorAll('.contact-form__label-error');
        const loadingIconElement = document.querySelector(".contact-form__loading-icon");
        const confirmationElement = document.querySelector(".contact-form__confirmation");

        //Don't let parent and child emails be equal. Styling is done in CSS
        if (parentEmail.value == childEmail.value) {
            //Turn on email error labels
            emailErrorLabels.forEach(errorLabel => errorLabel.classList.add('active-error'));
            parentEmailElement.classList.add('active-error');
            childEmailElement.classList.add('active-error');
            //Return here so that we don't go forward with POST request if there was an error in the emails
            return;
        } else if (document.querySelector('.active-error')) { //Only returns true if an element with the "active-error" class exists
            emailErrorLabels.forEach(errorLabel => errorLabel.classList.remove('active-error'));
            parentEmailElement.classList.remove('active-error');
            childEmailElement.classList.remove('active-error');
        }

        //Submit POST request
        const url = "https://api.suite.aurasvc.io/proxy/api/castor/create-subjects";
        const options = {
            method: 'POST',
            headers: { "content-type": "application/json" },
            body: JSON.stringify({
                parentEmail: parentEmail.value,
                childEmail: childEmail.value
            })
        };

        const postFormData = async () => {

            confirmationElement.classList.remove("confirmed-visible"); //Set to none in case this is the second submission.
            loadingIconElement.classList.add("loading-visible"); //Show spinning loading animation
            let errorExists = false;

            try {
                const response = await fetch(url, options);
                const data = await response.json();
                console.log(data);
            } catch (error) {
                console.log(error);
                errorExists = true;
                loadingIconElement.classList.remove("loading-visible"); //Hide loading icon
                alert("There was an error with your form submission. Please refresh the page and try again, or contact Aura support.");
            } finally {
                //Show visual confirmation once form data has been received
                if (!errorExists) {
                    loadingIconElement.classList.remove("loading-visible");
                    confirmationElement.classList.add("confirmed-visible"); //Show form confirmation check mark
                }
                event.target.reset(); //Reset form values
            }
        };
        postFormData();
    }

    contactFormElement.addEventListener('submit', (event) => {
        event.preventDefault(); // Prevent the form from submitting so we can grab the data
        submitForm(event);
    });

</script>